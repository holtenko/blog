---
title: JVM内存区域划分
date: 2016-04-09 15:20:35
categories: [Java]
tags: [Java,JVM,内存]
---
学习Java不可避免的要学习Java虚拟机，也就是JVM，Java虚拟机规范里面规定了程序运行期间会使用到的运行时数据区，这也是JVM的内存区域划分的模型，应该可以这么理解吧。

这其中有一些是随着虚拟机的启动和退出而创建和销毁的，这些区域是线程共享的，另外有一些是跟各个线程绑定的，随着线程的开始和结束而创建和销毁，我们可以称这些区域是线程私有的。
<!-- more -->

根据《Java虚拟机规范Java SE 7版》和《Java虚拟机规范Java SE 8版》的规定，我们可以划分出如下几个运行时数据区，如下图所示：
![JVMDataArea](https://tva1.sinaimg.cn/large/006tNbRwgy1g9qgn92jtlj30iu085glu.jpg)

### Java堆
在Java虚拟机中，堆是可供各个线程共享的运行时内存区域，也是供所有类实例和数组对象分配内存的区域。这块区域随着虚拟机的启动而创建，它的唯一使命就是**存放对象实例**，这块区域也是GC主要关注的地方。

下面的就是我的笔记本上的JVM堆的划分情况，可以看到分为新生代、老年代和永久代，新生代里面有可以分为Eden Space、From Survivor Space和To Survivor Space。
```{bash}
Heap Usage:
PS Young Generation
Eden Space:
   capacity = 17301504 (16.5MB)
   used     = 2483088 (2.3680572509765625MB)
   free     = 14818416 (14.131942749023438MB)
   14.351862127130682% used
From Space:
   capacity = 2621440 (2.5MB)
   used     = 2615312 (2.4941558837890625MB)
   free     = 6128 (0.0058441162109375MB)
   99.7662353515625% used
To Space:
   capacity = 6291456 (6.0MB)
   used     = 0 (0.0MB)
   free     = 6291456 (6.0MB)
   0.0% used
PS Old Generation
   capacity = 44564480 (42.5MB)
   used     = 13316368 (12.699478149414062MB)
   free     = 31248112 (29.800521850585938MB)
   29.88112505744485% used
PS Perm Generation
   capacity = 22020096 (21.0MB)
   used     = 14907008 (14.2164306640625MB)
   free     = 7113088 (6.7835693359375MB)
   67.6972888764881% used
```
根据虚拟机规范的规定，Java堆可以是固定的大小也可以是按照需求动态扩展的，而且不需要保证是连续的。

**存放内容：**所有的对象实例和数组。

### 方法区
方法区是一个线程共享的区域，它用于存储已被虚拟机加载的类信息、常量、静态变量。方法区是堆的逻辑组成部分，Hotspot用永久代实现了方法区。
方法区还包含运行时常量池(JDK1.7以后移到堆中)，用于存放编译时生成的各种字面量和符号引用，但是不要求常量一定是在编译时期产生的，运行期间也可以将新的常量放入池中，比如String的intern()方法便是利用了这一特性。

**存放内容：**类的结构信息，如类的字段、方法、接口、构造函数，还有运行时常量池等。

### 程序计数寄存器
这块区域是每个线程独立拥有的，也就是线程私有的，我们可以把它看作是当前线程所执行的字节码的行号指示器。

**这块区域时虚拟机规范里面唯一一个没有规定任何OutOfMemoryError情况的区域。**

**存放内容：**如果线程执行的是一个Java方法，那么寄存器里面记录的就是正在执行的虚拟机字节码指令的地址，如果线程执行的是一个native方法，那么寄存器记录的值为undefined。

### 虚拟机栈
虚拟机栈也是线程私有的内存区域。每个方法在执行的时候都会创建一个栈帧用于存储局部变量表、操作数栈、方法出口等信息，每一个方法从调用到执行完成就是一个栈帧入栈和出栈的过程。

局部变量表存放了编译时期可知的各种基本数据类型、对象引用和指向了一条字节码指令的地址。

**存放内容：**局部变量表、操作数栈、方法出口等信息。

### 本地方法栈
和虚拟机栈类似，存储Native方法的相关信息。
**存放内容：**局部变量表、操作数栈、方法出口等信息。
